# 학생 관계도 페이지 PRD (Product Requirement Document)

## 1. 개요
- 해당 페이지는 선택한 학급의 학생 관계를 시각적으로 표현하고, 학생 간 관계 설정 결과를 시각적으로 탐색할 수 있는 메인 관계도 뷰입니다.
- 참조 이미지: `학생관계도.png`, `학생관계도2.png`

## 2. 기술 스택
- 프론트엔드: Next.js, TypeScript, Tailwind CSS, D3.js
- 백엔드: Supabase (DB, 인증)
- 상태 관리: React Context + useState
- 배포: Vercel

## 3. 기능 설명

### 3.1 페이지 진입 및 레이아웃
- 이전 페이지(학급관리 페이지)에서 학급 카드를 클릭하면 이 페이지로 이동
- 상단에 학급명과 조작 버튼들이 나열됨
- 전체 UI는 참조 이미지와 동일한 레이아웃과 색상, 사이즈로 구성 (100% 동일하게 구현)

### 3.2 주요 버튼 및 동작

#### 1) 반 선택 (좌측 상단)
- 클릭 시 학급관리 페이지로 라우팅

#### 2) 추가 (학생 추가)
- 이름을 입력하고 엔터키를 누르거나 추가 버튼 클릭 시 학생 추가
- 중복된 이름은 입력 불가 (에러 토스트 메시지 출력)

#### 3) 관계 필터
- [전체보기, 친한 관계, 보통 관계, 안친한 관계] 버튼
- 각 버튼 클릭 시, 해당 관계만 관계도에서 표시됨
  - 친한 관계: 초록색 선
  - 보통 관계: 노란색 선
  - 안친한 관계: 빨간색 선
- 전체보기를 선택하면 모든 관계 표시

#### 4) 배치 변경
- D3.js force simulation을 랜덤하게 한 번 실행하여 배치 변경
- 사용자가 위치를 수동으로 바꾼 노드는 유지됨 (고정 노드는 배치변경 시에도 유지)

#### 5) 학생 초기화
- 모든 학생 데이터 및 관계 제거 (확인 모달 표시 후 실행)

### 3.3 학생 리스트 영역 (하단 박스)
- 추가된 학생 리스트가 나타나는 영역
- 카드 스타일로 표현, 마우스 호버 시:
  - 좌상단에 ✏️ 수정 아이콘: 이름 수정 가능 (수정 후 엔터로 저장)
  - 우상단에 🗑️ 삭제 아이콘: 학생 삭제 가능
- 학생 이름 카드 클릭 시 "학생 관계 설정 페이지"로 이동

### 3.4 학생 관계도 맵 (중앙 시각화 영역)
- D3.js를 사용해 학생 노드를 원 형태로 배치
- 학생 1명 = 하나의 노드 (원 + 이름 텍스트)
- 관계는 양방향 매칭 (친한 관계일 경우, 두 명이 서로 친한 선택 시 초록색 선으로 연결)
- 선 색상:
  - 친한 관계: 초록색
  - 보통 관계: 노란색
  - 안친한 관계: 빨간색

#### 노드 인터랙션 기능
- 노드 클릭 시:
  - 해당 학생 노드는 버튼 색상 계열로 강조 (두꺼운 테두리 + 컬러 하이라이트)
  - 해당 학생과 관계 있는 학생 노드 + 선만 강조됨, 나머지 흐리게(fade)
  - 하단 주관식 답변 영역에 해당 학생의 주관식 답변 출력
- 노드 드래그 가능
  - 사용자가 직접 위치 이동 가능
  - 사용자가 위치를 이동시킨 노드는 고정 상태 유지

### 3.5 주관식 답변 영역
- 클릭한 노드(학생)의 주관식 답변 내용 표시 (질문과 답변 페어)
- 질문은 모든 학생에게 동일하며, 답변은 개별 저장됨

### 3.6 관계 순위
- 모든 학생의 관계 수를 집계하여 순위로 표시
  - 친한 친구가 많은 순서 / 안친한 친구가 많은 순서 등
  - 각 범주(친함/보통/안친함)별로 TOP N 순위를 정리하여 표시

## 4. UI/UX 요소

### 공통 스타일
- 모든 카드, 버튼, 입력창에는 soft shadow 효과 적용
- 마우스 호버 시:
  - 버튼은 색상 변경 또는 강조 효과
  - 카드에는 테두리 강조

### 애니메이션
- 관계도 배치 이동: D3 애니메이션 사용 (force simulation)
- 노드 클릭 시 하이라이트/페이드 효과 부드럽게 전환

### 반응성
- 모든 UI 요소는 반응형 디자인으로 데스크탑/태블릿에서 잘 작동해야 함

## 5. 저장 및 데이터 연동
- Supabase DB에 다음 구조로 저장

#### 테이블 구조 예시
1. `classes` 테이블: 학급 정보 (id, name, created_at)
2. `students` 테이블: (id, name, class_id, gender, position_x, position_y)
3. `relations` 테이블: (id, from_student_id, to_student_id, relation_type)
4. `questions` 테이블: (id, question_text, class_id)
5. `answers` 테이블: (id, student_id, question_id, answer_text)

## 6. 이미지 참조
- `학생관계도.png`: 초기 구조와 레이아웃
- `학생관계도2.png`: 노드 하이라이트 및 관계 강조된 예시

---

> 다음 단계: 위 PRD 기반으로 Cursor AI에서 프로젝트 Scaffold 생성 요청 후, 페이지 컴포넌트부터 구현 진행